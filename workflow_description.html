<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overview &#8212; NTDMC inference pipeline  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="System-specific guides" href="guides/index.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h1>
<p>The pipeline can be divided into two distinct stages:</p>
<p>The <strong>parameter inference stage</strong> is about estimating a probablity
distribution for values of the epidemiological model parameters, using
the Adaptive Multilevel Importance Sampling algorithm. This stage
yields a collection of parameter values, together with their
corresponding statistical weight.</p>
<p>The <strong>model simulation stage</strong> then forward simulates the model for a
arbitrary number of parameter values sampled in the ensemble generated
by the inference stage.</p>
<p>The pipeline can be visualised with the following task graph.</p>
<img alt="_images/parallel_dag.svg" src="_images/parallel_dag.svg" /><p>The above depicts a pipeline with two IU groups, defined by the
prevalence level value, year of first MDA and year of last MDA (See
<a class="reference internal" href="#iu-grouping"><span class="std std-ref">IU grouping</span></a>).</p>
<section id="parameter-inference-stage">
<h2>Parameter inference stage<a class="headerlink" href="#parameter-inference-stage" title="Permalink to this heading">¶</a></h2>
<p>The parameter inference stage is made of three steps:</p>
<ol class="arabic simple">
<li><p>Grouping of Implementation Units (IUs).</p></li>
<li><p>Derivation of prevalence maps (one per group) based on original
dataset.</p></li>
<li><p>Execution of the Adaptive Multivelel Importance Sampling (AMIS)
algorithm.</p></li>
</ol>
<section id="iu-grouping">
<span id="id1"></span><h3>IU grouping<a class="headerlink" href="#iu-grouping" title="Permalink to this heading">¶</a></h3>
<p>The parameter inference (AMIS) algorithm is executed over several
groups of IUs, instead of the whole dataset.  This allows to divide
the computation into independent pieces of work that can run in
parallel.</p>
<p>Currently, IUs are grouped together according to values of first MDA
year, last MDA year, mean prevalence level. For instance, IU a group
<code class="docutils literal notranslate"><span class="pre">(first_mda=2008,</span> <span class="pre">last_mda=2019,</span> <span class="pre">level=3)1</span></code> groups together IUs for
which the first MDA occurs in year 2008, the last MDA in year 2019,
and for which the mean infection prevalence is between 20% and 30%
(assuming a prevalence level spans a 10% prevalence range).  IU
grouping will likely become configurable in the near future.</p>
</section>
<section id="prevalence-maps">
<h3>Prevalence maps<a class="headerlink" href="#prevalence-maps" title="Permalink to this heading">¶</a></h3>
<p>The input of the AMIS algorithm is a <strong>prevalence map</strong>, which is
derived from the original dataset.  A prevalence map contains K
samples of prevalence value for each IU in the dataset (or IU
group). It is stored in the CSV format with N rows and K columns.</p>
</section>
<section id="adaptive-multilevel-importance-sampling-amis">
<h3>Adaptive Multilevel Importance Sampling (AMIS)<a class="headerlink" href="#adaptive-multilevel-importance-sampling-amis" title="Permalink to this heading">¶</a></h3>
<p>Given a prevalence map and a model input file (both for a given IU
group), the AMIS algorithm generates an ensemble of possible model
parameter values, along with their associated statistical weight.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>beta</p></th>
<th class="head"><p>ETH18651</p></th>
<th class="head"><p>ETH19212</p></th>
<th class="head"><p>ETH19149</p></th>
<th class="head"><p>ETH19177</p></th>
<th class="head"><p>ETH19176</p></th>
<th class="head"><p>…</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.12</p></td>
<td><p>0.04</p></td>
<td><p>hello</p></td>
<td><p>0.55</p></td>
<td><p>a</p></td>
<td><p>a</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-odd"><td><p>0.34</p></td>
<td><p>0.12</p></td>
<td><p>0.32</p></td>
<td><p>0.67</p></td>
<td><p>a</p></td>
<td><p>a</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-even"><td><p>0.18</p></td>
<td><p>0.45</p></td>
<td><p>0.23</p></td>
<td><p>0.23</p></td>
<td><p>a</p></td>
<td><p>a</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-odd"><td><p>0.26</p></td>
<td><p>0.23</p></td>
<td><p>0.23</p></td>
<td><p>0.45</p></td>
<td><p>a</p></td>
<td><p>a</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-even"><td><p>0.56</p></td>
<td><p>0.76</p></td>
<td><p>0.23</p></td>
<td><p>0.29</p></td>
<td><p>a</p></td>
<td><p>a</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-odd"><td><p>0.22</p></td>
<td><p>0.23</p></td>
<td><p>0.23</p></td>
<td><p>0.38</p></td>
<td><p>a</p></td>
<td><p>a</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-even"><td><p>0.75</p></td>
<td><p>0.34</p></td>
<td><p>0.23</p></td>
<td><p>0.59</p></td>
<td><p>a</p></td>
<td><p>a</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
<p>In this example, the first column indicates sampled values for the
<span class="math notranslate nohighlight">\(\beta\)</span> parameter of the trachoma model.  The following columns
contain the associated statistical weight for these values, for each
IU in the IU group.</p>
</section>
</section>
<section id="model-simulation-stage">
<h2>Model simulation stage<a class="headerlink" href="#model-simulation-stage" title="Permalink to this heading">¶</a></h2>
<p>The model simulation stage is made of three steps:</p>
<ol class="arabic simple">
<li><p>Selection of model parameter values.</p></li>
<li><p>Model resimulation from <cite>START_YEAR</cite> to <cite>END_YEAR</cite>.</p></li>
<li><p>Model forward simulation.</p></li>
</ol>
<section id="selection-of-model-parameter-values">
<h3>Selection of model parameter values<a class="headerlink" href="#selection-of-model-parameter-values" title="Permalink to this heading">¶</a></h3>
<p>The forward simulation provides an ensemble forecast of the spread
over a collection of <span class="math notranslate nohighlight">\(n\)</span> values of the model parameter.  These
values are sampled within the ensemble generated by the AMIS algorithm,
according to their statistical weight.</p>
</section>
<section id="model-resimulation-to-end-year">
<h3>Model resimulation to <cite>END_YEAR</cite>.<a class="headerlink" href="#model-resimulation-to-end-year" title="Permalink to this heading">¶</a></h3>
<p>The AMIS algorithm relies on the simulation of the model from
<cite>START_YEAR</cite> to <cite>END_YEAR</cite>. However, storing the final simulation
state for each and every generated parameter values would require a
large amount of storage.  This storage would mostly be waster as only
a subset of generated parameter values are selected for forward
simulation.</p>
<p>Instead, the random generator seed is recored for each generated
paramter value, allowing the (re)simulation of the model over
<cite>START_YEAR</cite> and <cite>END_YEAR</cite> for the selected parameter values.  The
output of the resimulation is a file contained a serialised
representation model of the model state (e.g. a Python pickle file).</p>
</section>
<section id="forward-simulation">
<h3>Forward simulation<a class="headerlink" href="#forward-simulation" title="Permalink to this heading">¶</a></h3>
<p>Finally, the model can be simulated up to an arbitraty year using the
recorded state at <cite>END_YEAR</cite> as the initial condition.</p>
</section>
</section>
<section id="work-distribution">
<h2>Work distribution<a class="headerlink" href="#work-distribution" title="Permalink to this heading">¶</a></h2>
<p>The parameter inference stage is executed each IU group in the
original dataset.  These executions are indepent and can be executed
in any order, including in parallel if computational ressources allow.</p>
<p>Similarly, the model simulation stage is performed for a single
geographical location (Implementation Unit), independently of the
others. These model simulations can therefore be executed in any
order, including in parallel.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">NTDMC inference pipeline</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Required software</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#parameter-inference-stage">Parameter inference stage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-simulation-stage">Model simulation stage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#work-distribution">Work distribution</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="guides/index.html">System-specific guides</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="quickstart.html" title="previous chapter">Quickstart</a></li>
      <li>Next: <a href="guides/index.html" title="next chapter">System-specific guides</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Thibault Lestang.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/workflow_description.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>